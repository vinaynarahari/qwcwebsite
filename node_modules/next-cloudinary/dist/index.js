"use strict";var Le=Object.create;var F=Object.defineProperty;var Te=Object.getOwnPropertyDescriptor;var ve=Object.getOwnPropertyNames;var be=Object.getPrototypeOf,Ne=Object.prototype.hasOwnProperty;var We=(e,t)=>{for(var r in t)F(e,r,{get:t[r],enumerable:!0})},le=(e,t,r,d)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of ve(t))!Ne.call(e,o)&&o!==r&&F(e,o,{get:()=>t[o],enumerable:!(d=Te(t,o))||d.enumerable});return e};var h=(e,t,r)=>(r=e!=null?Le(be(e)):{},le(t||!e||!e.__esModule?F(r,"default",{value:e,enumerable:!0}):r,e)),Me=e=>le(F({},"__esModule",{value:!0}),e);var Be={};We(Be,{CldImage:()=>te,CldOgImage:()=>ne,CldUploadButton:()=>ie,CldUploadWidget:()=>Y,CldVideoPlayer:()=>de,cloudinaryLoader:()=>q,getCldImageUrl:()=>L,getCldOgImageUrl:()=>B,getCldVideoUrl:()=>xe});module.exports=Me(Be);var T=h(require("react")),Ce=h(require("next/image")),ee=require("@cloudinary-util/util"),Ie=require("@cloudinary-util/url-loader");var ye=require("@cloudinary-util/url-loader");var pe=h(require("next/package.json"));var se={name:"next-cloudinary",version:"6.14.1",license:"MIT",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup",dev:"tsup --watch",prepublishOnly:"cp ../README.md . && cp ../LICENSE . && pnpm build",postpublish:"rm ./README.md && rm ./LICENSE",test:"vitest run","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" pnpm build && cd tests/nextjs-app && npm install && npm run build',"test:watch":"vitest"},dependencies:{"@cloudinary-util/types":"1.5.10","@cloudinary-util/url-loader":"5.10.4","@cloudinary-util/util":"^3.3.2"},devDependencies:{"@babel/core":"^7.25.2","@babel/preset-env":"^7.25.3","@tsconfig/recommended":"^1.0.7","@types/node":"^22.0.2","@types/react":"^18.3.3","@types/react-dom":"^18.3.0",dotenv:"^16.4.5",mkdirp:"^3.0.1",tsup:"^8.2.3",typescript:"^5.5.4",vitest:"^2.0.5"},peerDependencies:{next:"^12 || ^13 || ^14 || >=15.0.0-rc",react:"^17 || ^18 || >=19.0.0-beta"}};var ce="A",ue="V",ge=fe(pe.default.version),me=fe(se.version);function fe(e){let t=e;return t.includes("-")&&(t=t.split("-")[0]),t}function x(e){let t=e?.cloud?.cloudName??process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME;if(!t)throw new Error("A Cloudinary Cloud name is required, please make sure NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME is set and configured in your environment.");let r=e?.cloud?.apiKey??process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,d=e?.url?.secureDistribution??process.env.NEXT_PUBLIC_CLOUDINARY_SECURE_DISTRIBUTION,o=e?.url?.privateCdn??process.env.NEXT_PUBLIC_CLOUDINARY_PRIVATE_CDN;return Object.assign({cloud:{...e?.cloud,apiKey:r,cloudName:t},url:{...e?.url,secureDistribution:d,privateCdn:o}},e)}function z(e){return Object.assign({product:ce,sdkCode:ue,sdkSemver:me,techVersion:ge,feature:""},e)}function L(e,t,r){return(0,ye.constructCloudinaryUrl)({options:e,config:x(t),analytics:z(r)})}function q({loaderOptions:e,imageProps:t,cldOptions:r,cldConfig:d={}}){let o={...t,...r};if(o.width=typeof o.width=="string"?parseInt(o.width):o.width,o.height=typeof o.height=="string"?parseInt(o.height):o.height,typeof e?.width=="number"&&typeof o.width=="number"&&e.width!==o.width){let n=e.width/o.width;o.width=e.width,typeof o.height=="number"&&(o.height=Math.floor(o.height*n))}else typeof e?.width=="number"&&typeof o?.width!="number"&&(o.width=e?.width);return L(o,d)}var Se=(0,T.forwardRef)(function(t,r){let d=!1,o=["assetType","config","deliveryType","strictTransformations"];Ie.transformationPlugins.forEach(({props:i})=>{Object.keys(i).forEach(I=>{if(o.includes(I))throw new Error(`Option ${I} already exists!`);o.push(I)})});let n={alt:t.alt,src:t.src};Object.keys(t).filter(i=>typeof i=="string"&&!o.includes(i)).forEach(i=>n[i]=t[i]);let p=Object.keys(n).map(i=>`${i}:${n[i]}`).join(";"),[O,C]=(0,T.useState)(p),l={};o.forEach(i=>{let y=t[i];y&&(l[i]=y)});let s=process.env.__NEXT_IMAGE_OPTS||{};(t.unoptimized===!0||s?.unoptimized===!0)&&(n.src=L({...l,width:n.width,height:n.height,src:n.src,format:"default",quality:"default"},t.config));async function A(i){let y=!0;if(d)return;if(d=!0,typeof t.onError=="function"){let U=t.onError(i);typeof U=="boolean"&&U===!1&&(y=!1)}else typeof t.onError=="boolean"&&t.onError===!1&&(y=!1);if(y===!1)return;let I=i.target;await(0,ee.pollForProcessingImage)({src:I.src})&&C(`${p};${Date.now()}`)}let b=(0,T.useCallback)(A,[ee.pollForProcessingImage,p]),g=Ce.default;return"default"in g&&(g=g.default),T.default.createElement(g,{key:O,...n,loader:i=>q({loaderOptions:i,imageProps:n,cldOptions:l,cldConfig:t.config}),onError:b,ref:r})}),te=Se;var P=h(require("react")),he=h(require("next/head"));function B(e){return L({...e,format:e.format||"jpg",width:e.width||1200,height:e.height||627,crop:e.crop||{type:"fill",gravity:"center",source:!0}})}var Ve="summary_large_image",ke=({excludeTags:e=[],twitterTitle:t,keys:r={},...d})=>{let{alt:o}=d,{width:n=1200,height:p=627}=d;n=typeof n=="string"?parseInt(n):n,p=typeof p=="string"?parseInt(p):p;let O=B({...d,width:n,height:p}),C=B({...d,width:n,height:p,format:d.format||"webp"}),l={"og:image":"og-image","og:image:secure_url":"og-image-secureurl","og:image:width":"og-image-width","og:image:height":"og-image-height","og:image:alt":"og-image-alt","twitter:title":"twitter-title","twitter:card":"twitter-card","twitter:image":"twitter-image",...r};return P.default.createElement(he.default,null,P.default.createElement("meta",{key:l["og:image"],property:"og:image",content:O}),P.default.createElement("meta",{key:l["og:image:secure_url"],property:"og:image:secure_url",content:O}),P.default.createElement("meta",{key:l["og:image:width"],property:"og:image:width",content:`${n}`}),P.default.createElement("meta",{key:l["og:image:height"],property:"og:image:height",content:`${p}`}),o&&P.default.createElement("meta",{key:l["og:image:alt"],property:"og:image:alt",content:o}),!e.includes("twitter:title")&&P.default.createElement("meta",{key:l["twitter:title"],property:"twitter:title",content:t||" "}),P.default.createElement("meta",{key:l["twitter:card"],property:"twitter:card",content:Ve}),P.default.createElement("meta",{key:l["twitter:image"],property:"twitter:image",content:C}))},ne=ke;var $=h(require("react"));var f=h(require("react")),Ue=h(require("next/script")),v=require("@cloudinary-util/url-loader");function Oe(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var Ge=({children:e,config:t,onError:r,onOpen:d,onUpload:o,options:n,signatureEndpoint:p,uploadPreset:O,...C})=>{let l=(0,f.useRef)(),s=(0,f.useRef)(),[A,b]=(0,f.useState)(void 0),[g,i]=(0,f.useState)(void 0),[y,I]=(0,f.useState)(!0),W=x(t),U=p&&(0,v.generateSignatureCallback)({signatureEndpoint:String(p),fetch}),D=(0,v.getUploadWidgetOptions)({uploadPreset:O||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,uploadSignature:U,...n},W),_=(0,v.generateUploadWidgetResultCallback)({onError:a=>{b(a),typeof r=="function"&&r(a,{widget:s.current,...G})},onResult:a=>{if(typeof a?.event!="string")return;i(a);let E=v.UPLOAD_WIDGET_EVENTS[a.event];if(typeof E=="string"&&typeof C[E]=="function"){let j=C[E];j(a,{widget:s.current,...G})}let R=`${E}Action`;if(R&&typeof C[R]=="function"){let j=C[R];j(a)}}});(0,f.useEffect)(()=>{if(typeof g>"u")return;g.event==="success"&&typeof o=="function"&&(process.env.NODE_ENVIRONMENT==="development"&&console.warn("The onUpload callback is deprecated. Please use onSuccess instead."),o(g,s.current))},[g]);function w(){I(!1),l.current||(l.current=window.cloudinary),Oe(()=>{s.current||(s.current=X())})}(0,f.useEffect)(()=>()=>{s.current?.destroy(),s.current=void 0},[]);function c(a,E=[]){if(s.current||(s.current=X()),typeof s?.current[a]=="function")return s.current[a](...E)}function H(a){c("close",[a])}function N(a){return c("destroy",[a])}function S(){c("hide")}function V(){return c("isDestroyed")}function k(){return c("isMinimized")}function m(){return c("isShowing")}function M(){c("minimize")}function Q(a,E){c("open",[a,E]),typeof d=="function"&&d(s.current)}function J(){c("show")}function Z(){c("update")}let G={close:H,destroy:N,hide:S,isDestroyed:V,isMinimized:k,isShowing:m,minimize:M,open:Q,show:J,update:Z};function X(){return l.current?.createUploadWidget(D,_)}return f.default.createElement(f.default.Fragment,null,typeof e=="function"&&e({cloudinary:l.current,widget:s.current,results:g,error:A,isLoading:y,...G}),f.default.createElement(Ue.default,{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://upload-widget.cloudinary.com/global/all.js",onLoad:w,onError:a=>console.error(`Failed to load Cloudinary Upload Widget: ${a.message}`)}))},Y=Ge;var Re=({className:e,children:t,onClick:r,onError:d,onOpen:o,onUpload:n,onAbort:p,onBatchCancelled:O,onClose:C,onDisplayChanged:l,onPublicId:s,onQueuesEnd:A,onQueuesStart:b,onRetry:g,onShowCompleted:i,onSourceChanged:y,onSuccess:I,onTags:W,onUploadAdded:U,options:D,signatureEndpoint:_,uploadPreset:w,onAbortAction:c,onBatchCancelledAction:H,onCloseAction:N,onDisplayChangedAction:S,onPublicIdAction:V,onQueuesEndAction:k,onQueuesStartAction:m,onRetryAction:M,onShowCompletedAction:Q,onSourceChangedAction:J,onSuccessAction:Z,onTagsAction:G,onUploadAddedAction:X,...a})=>$.default.createElement($.default.Fragment,null,$.default.createElement(Y,{onError:d,onOpen:o,onUpload:n,onAbort:p,onBatchCancelled:O,onClose:C,onDisplayChanged:l,onPublicId:s,onQueuesEnd:A,onQueuesStart:b,onRetry:g,onShowCompleted:i,onSourceChanged:y,onSuccess:I,onTags:W,onUploadAdded:U,options:D,signatureEndpoint:_,uploadPreset:w,onAbortAction:c,onBatchCancelledAction:H,onCloseAction:N,onDisplayChangedAction:S,onPublicIdAction:V,onQueuesEndAction:k,onQueuesStartAction:m,onRetryAction:M,onShowCompletedAction:Q,onSourceChangedAction:J,onSuccessAction:Z,onTagsAction:G,onUploadAddedAction:X},({open:E,isLoading:R})=>{function j(ae){ae.preventDefault(),E(),typeof r=="function"&&r(ae)}return $.default.createElement("button",{...a,className:e||"",onClick:j,disabled:R},t||"Upload")})),ie=Re;var u=h(require("react")),Pe=h(require("next/script")),we=h(require("next/head")),Ae=require("@cloudinary-util/url-loader");var K=[],Ee="1.11.1",je=e=>{let{className:t,config:r,height:d,id:o,onDataLoad:n,onError:p,onMetadataLoad:O,onPause:C,onPlay:l,onEnded:s,width:A}=e,b=(0,u.useId)(),g=x(r),i=(0,Ae.getVideoPlayerOptions)(e,g),{publicId:y}=i;if(typeof y>"u")throw new Error("Video Player requires a Public ID or Cloudinary URL - please specify a src prop");let I=(0,u.useRef)(),W=(0,u.useRef)(),U=e.videoRef||W,D=(0,u.useRef)(),_=e.playerRef||D,w=o||`player-${b.replace(/:/g,"")}`,c="cld-video-player cld-fluid";t&&(c=`${c} ${t}`),K.filter(m=>m===w).length>1?console.warn(`Multiple instances of the same video detected on the
     page which may cause some features to not work.
    Try adding a unique id to each player.`):K.push(w);let N={error:p,loadeddata:n,loadedmetadata:O,pause:C,play:l,ended:s};function S(m){let M=N[m.type];typeof M=="function"&&M(k())}function V(){"cloudinary"in window&&(I.current=window.cloudinary,_.current=I.current.videoPlayer(U.current,i),Object.keys(N).forEach(m=>{typeof N[m]=="function"&&_.current?.on(m,S)}))}(0,u.useEffect)(()=>()=>{_.current?.videojs.cloudinary.dispose(),K=K.filter(m=>m!==w)},[]);function k(){return{player:_.current,video:U.current}}return u.default.createElement(u.default.Fragment,null,u.default.createElement(we.default,null,u.default.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${Ee}/dist/cld-video-player.min.css`,rel:"stylesheet"})),u.default.createElement("div",{style:{width:"100%",aspectRatio:`${A} / ${d}`}},u.default.createElement("video",{ref:U,id:w,className:c,width:A,height:d}),u.default.createElement(Pe.default,{id:`cloudinary-videoplayer-${w}`,src:`https://unpkg.com/cloudinary-video-player@${Ee}/dist/cld-video-player.min.js`,onLoad:V,onError:m=>console.error(`Failed to load Cloudinary Video Player: ${m.message}`)})))},de=je;var _e=require("@cloudinary-util/url-loader");function xe(e,t,r){return(0,_e.constructCloudinaryUrl)({options:{assetType:"video",format:"auto:video",...e},config:x(t),analytics:z(r)})}0&&(module.exports={CldImage,CldOgImage,CldUploadButton,CldUploadWidget,CldVideoPlayer,cloudinaryLoader,getCldImageUrl,getCldOgImageUrl,getCldVideoUrl});
//# sourceMappingURL=index.js.map